class BabylonGame{constructor(e,n){console.log("Babylon Game Init!!"),this.canvas=e,this.config={mode:BabylonConstant.GAMEMODE.PLAY,...n},this.engine=null,this.currentScene=null,this.listeners={},this.currentGizmoType=BabylonConstant.GIZMO.POSITION,this.disposeQueue=[]}static create(e,n){const t=new BabylonGame(e,n),{engineType:i}=t.config;return t.initEngine(i,e),t.setLoadingScreen(),t.isPlayMode()&&setGameApiFunctions(t),t}dispose(){this.engine&&this.engine.dispose()}getBaseUrl(){return this.config.assetBaseURL}initEngine(e,n){if(this.engine)return;let t;t=this.createDefaultEngine(n),this.engine=t,window.addEventListener("resize",t.resize.bind(t))}createDefaultEngine(e){return new BABYLON.Engine(e,!0,{preserveDrawingBuffer:!0,stencil:!0})}getErrorHandler(){return function(e,n){parent.postMessage({source:"wizlab",type:"error",error:e,payload:n})}}createScene(e){const n=this.getSceneData(e);return BabylonScene.create({game:this,data:n})}getSceneData(e){return this.config.scenes[e]}updateSceneData(e,n){this.config.scenes[e]=n}runScene(e){this.runRenderLoopIfNeed();const n=this.createScene(e);n&&this.onSceneLoaded(n)}async onSceneLoaded(e){const n=this.currentScene;n!==e&&(this.currentScene=e,this.isPlayMode()&&this.currentScene.runAllUserScript(),n&&this.disposeQueue.push(n),this.disposeQueue.length>0&&(this.currentScene.scene.isReady()||await this.currentScene.scene.whenReadyAsync(),this.disposeAllQueue()))}disposeAllQueue(){const e=this.disposeQueue.length;if(0!==e)for(let n=0;n<e;n++){this.disposeQueue.pop().dispose()}}runRenderLoopIfNeed(){this.isRenderLoopRunning||(this.isRenderLoopRunning=!0,this.engine.runRenderLoop((()=>{this.currentScene&&this.currentScene.render()})))}removeCurrentScene(){this.isRenderLoopRunning&&(this.engine.stopRenderLoop(),this.engine.clear(),this.isRenderLoopRunning=!1),this.currentScene&&(this.currentScene.dispose(),this.currentScene=null)}changeScene(e){this.runScene(e)}changeSceneWithName(e){for(let n in this.config.scenes){if(e===this.config.scenes[n].name)return this.changeScene(n),!0}return!1}getSoundAssets(){return this.config.assets?this.config.assets.sounds:null}on(e,n){this.listeners[e]=n}getListener(e){return this.listeners[e]}triggerListener(e,n){const t=this.getListener(e);t&&t(n)}getCurrentGizmoType(){return this.currentGizmoType}setCurrentGizmoType(e){this.currentGizmoType=e,this.currentScene&&this.currentScene.onChangeCurrentGizmoType(e)}isPlayMode(){return this.isModeEqualTo(BabylonConstant.GAMEMODE.PLAY)}isEditMode(){return this.isModeEqualTo(BabylonConstant.GAMEMODE.EDIT)}isPreviewMode(){return this.isModeEqualTo(BabylonConstant.GAMEMODE.PREVIEW)}isModeEqualTo(e){return this.config.mode===e}setLoadingScreen(){BABYLON.DefaultLoadingScreen.prototype.displayLoadingUI=function(){let e=document.getElementById("babylonLoadingScreen");if(!e){this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonLoadingScreen",this._loadingDiv.innerHTML='\n          <div class="babylonLoadingScreen_content_container">\n            <div class="babylonLoadingScreen_content_aspect">\n              <div class="babylonLoadingScreen_content">\n                <div class="babylonLoadingScreen_progress"></div>\n                <div class="babylonLoadingScreen_title">\n                  에셋 로딩 중...\n                </div>\n              </div>\n            </div>\n          </div>\n        ';const n=document.createElement("style");n.innerHTML="\n          #babylonLoadingScreen{\n            position: relative;\n            display: flex;\n            transition: opacity 0.6s;\n            pointer-events: none;\n          }\n          .babylonLoadingScreen_content_container {\n            margin: auto;\n            width: 120px;\n          }\n          .babylonLoadingScreen_content_aspect {\n            position: relative;\n            padding-top: 100%;\n          }\n          .babylonLoadingScreen_content {\n            position: absolute;\n            display: flex;\n            flex-direction: column;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            border-radius: 12px;\n            background-color: #141821ee;\n            box-shadow: 5px 5px 15px 0px rgba(0, 0, 0, 0.2);        \n          }\n          .babylonLoadingScreen_progress {\n            margin: auto auto 0 auto;\n            width: 36%;\n            height: 36%;\n            border: 5px solid #393e4f;\n            border-top-color: white;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n          }\n          @keyframes spin {\n            to {\n              transform: rotate(360deg);\n            }\n          }\n          .babylonLoadingScreen_title {\n            margin: 18px auto auto auto;\n            color: white;\n            font-size: 15px;\n            font-weight: bold;\n            font-family: Arial;\n          }\n        ",document.getElementsByTagName("head")[0].appendChild(n),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),document.body.appendChild(this._loadingDiv),e=this._loadingDiv}e.style.display="flex",e.style.opacity=1},BABYLON.DefaultLoadingScreen.prototype.hideLoadingUI=function(){const e=document.getElementById("babylonLoadingScreen");e&&(e.style.opacity=0,setTimeout((()=>{e.style.display="none"}),600))}}}window.BabylonGame=BabylonGame;